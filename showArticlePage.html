<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <title>글 내용페이지</title>
</head>
<body>
    <div id="homeLink"></div>
<br>
    <div id="welcomeArea"></div>
    <div id="checkLogin"></div>
    <br>
    <div id="titleArea"></div>
    <div id="writerArea"></div>
    <div id="clickedArea"></div>
    <div id="createdArea"></div>
    <div id="textArea"></div>
    <div id="updateOrDeleteButtonArea"></div>
    <div id="writeComentArea"></div>
    <ul id="comentArea"></ul>
    <div id="pageArea"></div>
   
<script src="/lib/js/jslib.js"></script>
<script>
var requestUrl;
var result;
var loginBool=false;
window.onload=function(){
    checkLogin();
    makeHomeLink();
    getArticle(1);
    
}
function getArticle(page) {
    requestUrl='http:localhost:8080/auth/getArticle';
    let data=JSON.stringify({
         "bid":getParameterByName(location.search,'bid'),
         "page":page,
	});
    result=fisrtRequest(requestUrl,data);
    console.log(result);
    if(result.bool){
        var article=result.article;
        var coment=result.coments;
        makeArticle(article);
        makeComentInput();
        makeComent(coment);
        makeButtons(article);
        return;
    }
    alert(result.messege);
    location.href='index.html';
    
}
function makeButtons(article) {
   var  loginEmail=getLoginEmail();
   if(loginEmail==article.email){
       $('#updateOrDeleteButtonArea').append("<input type='button' onclick='goUpdatePage("+article.bid+")' value='글수정'><input type='button' onclick='deleteArticle("+article.bid+")' value='글삭제'> ");
   }
}
function makeArticle(article) {
    document.getElementById('titleArea').innerHTML=('제목: '+article.title);
    document.getElementById('writerArea').innerHTML=('작성자: '+article.email);
    document.getElementById('clickedArea').innerHTML=('조회수: '+article.clicked);
    document.getElementById('createdArea').innerHTML=('작성일: '+article.created);
    document.getElementById('textArea').innerHTML=('내용<br>'+article.text);
}
function makeComentInput() {
    var holderMessage;
    if(loginBool){
        holderMessage='로그인후 작성해주세요';
    }else{
        holderMessage='최대 100글자입니다';
    }
    document.getElementById('writeComentArea').innerHTML=("댓글작성<br><input type='text' placeholder='"+holderMessage+"'>"); 
}
function makeComent(coment) {
    for(var i=0;i<coment.length;i++){
        $('#comentArea').append("<li>작성자 : "+coment[i].email+"<br>내용<br><div id='coment"+coment[i].cid+"'>"+coment[i].text+"</div></li>");
    }
}
function goUpdatePage(bid) {
    location.href='updateArticlePage.html?bid='+bid;
}
function deleteArticle(bid) {
    requestUrl='http:localhost:8080/api/deleteArticle';
    let data=JSON.stringify({
         "bid":bid
	});
    result=fisrtRequest(requestUrl,data);
    alert(result.messege);
    if(result.bool){
        location.href='index.jsp';
    }
}     
</script> 
</body>
</html>