<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://tbnpg.settlebank.co.kr/resources/js/SettlePG.js"></script>
    <title>홈페이지</title>
</head>
<body>
    <a href="/index.html">Kim's Shop</a>
    <div id="welcomeArea"></div>
    <div id="checkLogin"></div>
    <br>
    <input type="button" value="카카오전송" onclick="kakaosend()">
    <a href='/boardPage.html'>후기게시판</a>
    <script src="/lib/js/jslib.js"></script>
 <script>


var xhr=new XMLHttpRequest();
var requestUrl;
var result;
window.onload = function () {
    checkLogin();
}
function kakaosend() {
    var requestUrl='http://localhost:8080/api/sendKakaoMessage';
	result=fisrtRequest(requestUrl,null);
    console.log(result); 
    location.href=result.messege;
}
function checkLogin(){
        xhr.open('POST','http://localhost:8080/api/email',true);
        xhr.setRequestHeader("Content-Type",'application/json');
        xhr.withCredentials = true;
        xhr.send();
        xhr.onload=function(){
            if(xhr.status==403){
                document.getElementById('checkLogin').innerHTML=("<a href='/singupPage.html'>회원가입</a><a href='/loginPage.html'>로그인</a>");  
                return;
            }else if(xhr.status==200){
                var result=JSON.parse(xhr.response);
                console.log(result);
                if(result.status=='newJwtToken'){
                    location.reload(true);
                    result=getNewAccesToken('http://localhost:8080/api/email',null);
                }
                document.getElementById('welcomeArea').innerHTML=(result.email+"님 환영합니다");
                document.getElementById('checkLogin').innerHTML=("<a href='/myPage.html'>마이페이지</a><a href='/reservationPagevar3.html'>예약페이지</a><a href='/foodBuyPage.html'>커피와케이크</a>");
            }       
        }
}
 </script>
</body>
</html>


