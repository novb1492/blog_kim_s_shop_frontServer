<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홈페이지</title>
</head>
<body>
    <a href="/index.html">Kim's Shop</a>
    <div id="welcomeArea"></div>
    <div id="checkLogin"></div>
    <br>
    <script src="/lib/js/jslib.js"></script>
 <script>
var xhr=new XMLHttpRequest();
var requestUrl;
var result;
window.onload = function () {
    checkLogin();
}
function checkLogin(){
        xhr.open('POST','http://localhost:8080/api/email',true);
        xhr.setRequestHeader("Content-Type",'application/json');
        xhr.withCredentials = true;
        xhr.send();
        xhr.onload=function(){
            if(xhr.status==403){
                document.getElementById('checkLogin').innerHTML=("<a href='/singupPage.html'>회원가입</a><a href='/loginPage.html'>로그인</a>");  
                return;
            }else if(xhr.status==200){
                var result=JSON.parse(xhr.response);
                console.log(result);
                if(result.status=='newJwtToken'){
                    location.reload(true);
                    result=getNewAccesToken('http://localhost:8080/api/email',null);
                }
                document.getElementById('welcomeArea').innerHTML=(result.email+"님 환영합니다");
                document.getElementById('checkLogin').innerHTML=("<a href='/myPage.html'>마이페이지</a><a href='/reservationPagevar3.html'>예약페이지</a><a href='/writeArticlePage.html'>글쓰기</a>");
            }       
        }
}
 </script>
</body>
</html>


